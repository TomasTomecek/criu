#!/usr/bin/env python

# This script checks if the device used in the actual test exists on this host

import os
import stat
import errno
import platform

filename = 'vt.checker'
minor = -1
exists = True

if platform.machine() == 's390x':
    minor = 65
else:
    minor = 5

try:
    os.unlink(filename)
except FileNotFoundError:
    pass

print("Running on %s with minor %d" % (platform.machine(), minor))
os.mknod(filename, mode=0o640 | stat.S_IFCHR, device=os.makedev(4, minor))
try:
    os.open(filename, os.O_RDONLY)
except OSError as e:
    if e.errno == errno.ENXIO:
        print("OS error({0}): {1}".format(e.errno, e.strerror))
        exists = False

os.unlink(filename)

if exists:
    exit(0)
exit(1)
